---
title: "Today I Learned_230710"
date: 2023-07-10 21:17:00 +0900
---

# í† ë¹„ì˜ ìŠ¤í”„ë§ 3.1

<aside>
ğŸ’¡ í…œí”Œë¦¿ê³¼ ì½œë°±ì„ ì°¾ì•„ë‚¼ ë•Œ

â†’ ë³€í•˜ëŠ” ì½”ë“œì˜ ê²½ê³„ë¥¼ ì°¾ê³  ê·¸ ê²½ê³„ë¥¼ ì‚¬ì´ì— ë‘ê³  ì£¼ê³ ë°›ëŠ” ì¼ì •í•œ ì •ë³´ê°€ ìˆëŠ”ì§€ í™•ì¸

</aside>

ì œë„¤ë¦­ìŠ¤ íƒ€ì…ì„ ì‚¬ìš©í•˜ì—¬ í…œí”Œë¦¿/ì½œë°±ì„ ë²”ìš©ì ìœ¼ë¡œ ë§Œë“¤ë©´ ì—¬ëŸ¬ ê¸°ëŠ¥ë“¤ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

ë³€í•˜ëŠ” ë¶€ë¶„ì´ ì½œë°±ì´ ëœë‹¤!

## JdbcTemplate

ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” JDBC ì½”ë“œìš© ê¸°ë³¸ í…œí”Œë¦¿

ìƒì„±ìì˜ íŒŒë¼ë¯¸í„°ë¡œ DataSourceë¥¼ ì£¼ì…ë°›ì•„ ì‚¬ìš©

### update()

- PreparedStatementCreatoríƒ€ì…ì˜ ì½œë°±ì„ ë°›ì•„ì„œ ì‚¬ìš©
- ì½œë°±ì„ ë°›ì§€ ì•Šê³  ë‚´ì¥ ì½œë°±ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŒ
- SQLê³¼ í•¨ê»˜ ê°€ë³€ì¸ìë¡œ ì„ ì–¸ëœ íŒŒë¼ë¯¸í„°ë¥¼ ì œê³µí•˜ë©´ íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ê°€ëŠ¥

```java
// ì½œë°± ë°›ì•„ ì‚¬ìš©
public void deleteAll() throws SQLException {
        this.jdbcTemplate.update(
                new PreparedStatementCreator() {
                    @Override
                    public PreparedStatement createPreparedStatement(Connection con) throws SQLException {
                        return con.prepareStatement("delete from users");
                    }
                }
        );
    }

// ë‚´ì¥ ì½œë°± ì‚¬ìš©
public void deleteAll() throws SQLException {
        this.jdbcTemplate.update("delete from users");
    }

// ê°€ë³€ì¸ì íŒŒë¼ë¯¸í„° ë°›ì•„ ì‚¬ìš©
public void add(final User user) throws SQLException {
        this.jdbcTemplate.update("insert into USER(id, name, password) values (?, ?, ?)",
                user.getId(), user.getName(), user.getPassword());
    }
```

### query()

- PreparedStatementCreator ì½œë°±ê³¼ ResultSetExtractor ì½œë°±ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ ì‚¬ìš©
- PreparedStatementCratorëŠ” connectionì„ ë°›ì•„ PreparedStatementë¥¼ ëŒë ¤ì¤Œ
- ResultSetExtractorëŠ” í…œí”Œë¦¿ì„ ìˆ˜í–‰í•´ ResultSetì„ ë°›ì•„ ìˆ˜í–‰, ê·¸ ê²°ê³¼ë¥¼ ëŒë ¤ì¤Œ
- ë‘ ë²ˆì˜ í…œí”Œë¦¿/ì½œë°±ì´ ë™ì‘í•œë‹¤ê³  ë³´ë©´ ëœë‹¤.

```java
public int getCount() throws SQLException {
        return this.jdbcTemplate.query(new PreparedStatementCreator() {
            @Override
            public PreparedStatement createPreparedStatement(Connection con) throws SQLException {
                return con.prepareStatement("select count(*) from USER");
            }
        }, new ResultSetExtractor<Integer>() {
            @Override
            public Integer extractData(ResultSet rs) throws SQLException, DataAccessException {
                rs.next();
                return rs.getInt(1);
            }
        });
    }
```

### queryForObject()

- ResultSetExtractorëŠ” ResultSetì„ í•œ ë²ˆ ì „ë‹¬ë°›ì•„ ì•Œì•„ì„œ ì¶”ì¶œì‘ì—…ì„ ì§„í–‰í•˜ê³  ìµœì¢… ê²°ê³¼ë§Œ ë¦¬í„´
- RowMapperëŠ” ResultSetì˜ ë¡œìš° í•˜ë‚˜ë¥¼ ë§¤í•‘í•˜ê¸° ìœ„í•´ ì‚¬ìš©
- queryForObject(String, Object[], RowMapper<T>)ëŠ” deprecatedë¨

```java
public User get(String id) throws SQLException {
        return this.jdbcTemplate.queryForObject("select * from USER where id = ?",
                new Object[] {id},      // SQLì— ë°”ì¸ë”©í•  íŒŒë¼ë¯¸í„° ê°’. ê°€ë³€ì¸ì ëŒ€ì‹  ë°°ì—´ì„ ì‚¬ìš©
                new RowMapper<User>() {
                    @Override
                    public User mapRow(ResultSet rs, int rowNum) throws SQLException {
                        User user = new User();
                        user.setId(rs.getString("id"));
                        user.setName(rs.getString("name"));
                        user.setPassword(rs.getString("password"));
                        return user;
                    }
                });
    }
```

- í•œê°œì˜ Rowë§Œ returní•  ê²ƒì„ ê¸°ëŒ€í•œ í•¨ìˆ˜
- rowì˜ ê°œìˆ˜ê°€ í•˜ë‚˜ê°€ ì•„ë‹ˆë¼ë©´ ì˜ˆì™¸ ë°œìƒ
    - EmptyResultDataAccessException

### query()

```java
public List<User> getAll() {
        return this.jdbcTemplate.query("select * from USER order by id",
                new RowMapper<User>() {
                    @Override
                    public User mapRow(ResultSet rs, int rowNum) throws SQLException {
                        User user = new User();
                        user.setId(rs.getString("id"));
                        user.setName(rs.getString("name"));
                        user.setPassword(rs.getString("password"));
                        return user;
                    }
                });
    }
```

- RowMapperëŠ” ì¿¼ë¦¬ì˜ ê²°ê³¼ì¸ ResultSetì˜ ëª¨ë“  rowë¥¼ ì—´ëŒí•˜ë©´ì„œ ë¡œìš°ë§ˆë‹¤ RowMapper ì½œë°±ì„ í˜¸ì¶œ
- í˜„ì¬ rowì˜ ë‚´ìš©ì„ Useríƒ€ì… ì˜¤ë¸Œì íŠ¸ì— ë§¤í•‘í•´ì„œ ëŒë ¤ì¤Œ

í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ë•Œ ë¯¸ë¦¬ ì˜ˆì™¸ìƒí™©ì— ëŒ€í•œ ì¼ê´€ì„± ìˆëŠ” ê¸°ì¤€ì„ ì •í•´ë‘ê³  ì´ë¥¼ í…ŒìŠ¤íŠ¸ë¡œ ë§Œë“¤ì–´ì„œ ê²€ì¦í•˜ì.

ë¡œë“œ ì¡´ìŠ¨ ì•„ì €ì”¨ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ë•Œ í•­ìƒ ë„¤ê±°í‹°ë¸Œ í…ŒìŠ¤íŠ¸ë¶€í„° ë§Œë“¤ì—ˆë‹¤ê³  í•œë‹¤.

í…œí”Œë¦¿/ì½œë°± íŒ¨í„´ì„ ì˜ í™œìš©í•˜ë©´ ì‘ì§‘ë„ê°€ ë†’ì€ ì½”ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ì¡°ì‘í• ì§€ / DBì— ì–´ë–»ê²Œ ë¶™ì„ì§€ ë¶„ë¦¬í•  ìˆ˜ ìˆë‹¤.